=============================================================================
このプラグインについて
=============================================================================

ゲーム中に以下の事を可能にするプラグインです

・セーブファイルを直接改造
・破損したセーブファイルの修復
・セーブファイルへパッチ処理（チェックサム修正、改造コード適用、その他　自由な処理）
・セーブファイルのバックアップ(CFWのVerに依存しないファイル)
・GameKeyの収集
・その他


らぼこ、Savedata En/Decrypter などとは違い
ゲーム中にセーブファイルを操作可能で
GameKeyを別に探す必要もありません


※説明は"英語版"を元にしてます
　セーブファイルが破損する可能性もあります
　必ずバックアップを取ったうえで十分注意してお使い下さい
　いかなる損害を被っても製作者は一切の責任を負いかねます



=============================================================================
インストール方法
=============================================================================

MagicSave、seplugins フォルダをメモリースティックのルート（直下）へコピー 
ms0:/seplugins/game.txtを開いて

ms0:/seplugins/MagicSave.prx 1

を追記後、保存



=============================================================================
ファイル/フォルダの構成 について
=============================================================================

・seplugins	= プラグインファイル


"MagicSave"	= MagicSaveのルートフォルダ
┃
┣"Plugins"	= セーブファイルをロード、セーブした際
┃		  そのデータへ任意処理するためのプラグインを置いておく場所です
┃		 【プラグイン機能について】を参照
┃
┣"Gamekey"	= Dump Gamekey を有効にした場合、ここへ保存されます
┃
┣"Config"	= ゲーム別の設定を取得/保存するのためのフォルダです
┃　		【ゲーム別 設定ファイルについて】を参照
┃		※ここへ default.ini を置くと、各設定の初期値を変更可能です
┃
┗"Save"	= バックアップでセーブファイルを読み書きするフォルダです



=============================================================================
ゲーム別 設定ファイルについて
=============================================================================

ゲームの起動時に、メニューの設定変更時に
MagicSave/Config/ゲームID.ini ファイルに対して読み込み/書き込みします
(メニューを閉じた際、項目の変更が無ければ書き込みはされません）


ゲームIDは XXXXYYYYY という形式（X = 英字、Y=数字）で
ゲームのパッケージなどに書かれているので確認して下さい

※起動時に対象ゲームの設定ファイルがない場合の初期値は全てデフォルトの値です
　設定を変更する際に ファイルがまだない場合は作成、記述がない場合は追記 をして下さい


記述可能な設定は以下の通りです
(1行256文字まで、大文字小文字は区別せず比較します)



■メニューを閉じた際に自動書き込み（更新）される設定


Save_Format		= セーブファイルのフォーマット（保存形式）を指定
			　Auto = そのまま　、Raw = 非暗号化状態　、Normal = 暗号化状態（PSP標準）
			　デフォルト:Auto

DumpGameKey		= セーブファイルを読み書きする際、GameKeyもDumpするかどうか
			　True = 有効　、False = 無効
			　デフォルト:False


BackUp_Save		= セーブ時にバックアップファイル（ ms0:/MagicSave/Save/XXXX ）を書き込むかどうか
			　True = 有効　、False = 無効
			　デフォルト:False
			　

BackUp_Load		= ロード時にバックアップファイル（ ms0:/MagicSave/Save/XXXX ）を読み込むかどうか
			　True = 有効　、False = 無効
			　デフォルト:False
			　
			　※BackUp_Save / BackUp_Load それぞれの設定状態が違うと
			　　古いバックアップファイルを読み込んでしまう恐れがあるがある為
			　　意図して別動作をさせたい場合以外は両方とも有効 または 無効にして下さい


Menu_Delay		= メニュー表示のちらつきを抑えるための機能です
			　デフォルト:1000

Menu_Type		= メニューへ表示するアイテムの種類を指定します
			　All = 全て 、 Active = 選択中の項目のみ
			　デフォルト:Active
			　
			　※選択中の項目のみにすると、メニュー描画時の負荷を軽減出来る

Menu_Stop_Other		= メニュー表示時に、ゲーム側の操作を無効にするかどうかを指定
			　True = 有効　、False = 無効
			　デフォルト:False


■手動で追記しない限り変更出来ない設定
※RID/RID_SFO/RID_DECについては起動直後に変更する必要がある場合に備えて
　緊急時の為に用意してある物なので不要な時は無効にして下さい

Hook			= MagicSaveが行うセーブファイル操作関連の全て（関数へのフック）を起動時に一時的に無効にしておくオプション
			　有効のままだと起動時またはゲーム中に問題となるゲームへの対応（通常は必要なし）
			  起動後有効にしたい時はメニューのオプションからフック→有効
			　True = 有効　、False = 無効
			　デフォルト:False
			　設定ファイルへ記述されていれば起動時から無効状態


RID			= 破損ファイルを読み込み可能にするかどうか
			　True = 有効　、False = 無効
			　デフォルト:False
			　

RID_SFO			= 修復するファイルのセーブタイプを指定（セーブした時のFW)
			　Type1 = FW 3.71より前　、Type2 = FW3.71より後のファイル、Type3 = FW 2.0より前のファイル
			　デフォルト:Type1
			　
			　※デフォルトはあくまで参考値なので、最適な設定を探して下さい
			　　RID = Falseだと機能しません

RID_DEC			= 修復するセーブファイルの復号化方法を指定
			　Type1 = 要求FWがFW 1.0〜1.5Xのゲーム、 Type2/Type3 = 最近のゲーム
			　デフォルト:Type3
			　
			　※デフォルトはあくまで参考値なので、最適な設定を探して下さい
			　　RID = Falseだと機能しません

Menu			= メニュー機能の有効/無効
			　True = 有効　、False = 無効
			　デフォルト:True
			　
			　※Falseにすると、通常版でもメニューを無効に出来ます

Menu_Pos_X		= メニューを表示する位置X
			　デフォルト:96

Menu_Pos_Y		= メニューを表示する位置Y
			　デフォルト:24

Menu_Key_Show		= メニューを表示する為のKey
		　　	　デフォルト:VolUp + VolDown

Menu_Key_Back		= メニューを閉じる、前の項目へ戻る為のKey
		　	　デフォルト:Triangle

Menu_Key_Select		= メニュー上のアイテムを選択する為のKey
		　	　デフォルト:Cross

Menu_Key_Up		= メニューを 上 へ移動する為のKey
		　	　デフォルト:Up

Menu_Key_Down		= メニューを 下 へ移動する為のKey
		　	　デフォルト:Down

Menu_Key_Left		= メニューを 左 へ移動する為のKey
		　	　デフォルト:Left

Menu_Key_Right		= メニューを 右 へ移動する為のKey
			　デフォルト:Right


Menu_Pos_X、Menu_Pos_Yについては、
メニューが画面の外へ出てしまうような値を指定すると
表示した瞬間にフリーズしたりするので注意



各操作用のボタン設定 ( Menu_Key_XXXX )は自由に変更可能
下記の物から複数組み合わせて指定出来ます

ini側へ記述する文字	対応するボタン
SELECT			= セレクト
START			= スタート
Up			= 十字キー 上
Right			= 十字キー 右
Down			= 十字キー 下
Left			= 十字キー 左
LTrigger		= Lトリガー
RTrigger		= Rトリガー
Triangle		= △
Circle			= ○
Cross			= ×
Square			= □
HOME			= HOME
HOLD			= 電源側のHOLD
NOTE			= ♪
SCREEN			= 明るさ調整
VolUp			= 音量+
VolDown			= 音量-



=============================================================================
default.iniについて
=============================================================================
ゲーム別 設定ファイルがまだないゲームは
MagicSaveが各設定の初期値を一括して自動設定する仕様になっていますが
それぞれ自由に指定することも可能です

default.ini ファイルを開き必要に応じて初期値を変更した後、
ms0:/MagicSave/Congig/ フォルダへ移動させると有効になります

ms0:/MagicSave/Config フォルダ内の設定ファイルは
default.ini(最初) -> ゲーム別 設定ファイル(次）
と言う順番で読み込まれます

default.ini で初期値を指定しても
ゲーム別 設定ファイルで同じ項目が指定されている場合
そちらの設定が優先されます

=============================================================================
メニューの各項目について
=============================================================================

┣"GAME ID : XXXXYYYYY"		起動しているゲームのID
┃
┣"Save Data"			セーブファイル読み書きについての設定
┃┃				("Option"にある"Hook"をDisable(無効)にすると"Save Data"以下の項目は機能しなくなります。
┃┃				メニューからも選べなくなる。有効にすれば元に戻る。)
┃┃				
┃┣"Save Format"		(【 ゲーム別 設定ファイルについて 】 にある Save_Format を参照）
┃┃				セーブ、ロード中にフォーマットを変更してしまうと
┃┃				ファイルが破損する危険性があります
┃┃
┃┣"Dump Gamekey"		(【 ゲーム別 設定ファイルについて 】 にある Dump_GameKey を参照）
┃┃
┃┣"Read Invalid Data"		破損ファイル扱いになるセーブファイルを読み込み可能にするかどうか
┃┃┣"Enable			(【 ゲーム別 設定ファイルについて 】にある RID を参照)
┃┃┃
┃┃┣"SFO File"		(【 ゲーム別 設定ファイルについて 】にある RID_SFO を参照)
┃┃┗"Decrypt"			(【 ゲーム別 設定ファイルについて 】にある RID_DEC を参照)
┃┃
┃┣"Plugin"			※起動しているゲームへ対応するプラグインがなければ表示されない
┃┃┣"Enable"			プラグイン機能を使用するかどうか
┃┃┃
┃┃┃				起動しているゲームへ対応するプラグインがなければ機能しない
┃┃┃				プラグイン起動に成功すると選択状態になり、選択状態を解除すればアンロードされる
┃┃┃				詳しくは【プラグイン機能について】を参照
┃┃┃
┃┃┣"Load"			"ロード"時にデータ処理をさせる、プラグイン側の関数を指定
┃┃┗"Save"			"セーブ"時にデータ処理をさせる、プラグイン側の関数を指定
┃┃
┃┗"BackUp"
┃　┣"Read from MagicSave"	(【 ゲーム別 設定ファイルについて 】にある BackUp_Load を参照)
┃　┗"Write to  MagicSave"	(【 ゲーム別 設定ファイルについて 】にある BackUp_Save を参照)
┃
┗"Option"
　┣"System"
　┣"Hook"			(【 ゲーム別 設定ファイルについて 】にある Hook を参照)
　┃				※HookをDisable(無効）にすると"Save Data"以下の項目は機能しなくなります。
　┃				（メニューからも選べなくなる。有効にすれば元に戻る。）
　┃
　┣"Menu"			メニュー表示関係の設定変更
　┣"Delay"			(【 ゲーム別 設定ファイルについて 】 にある Menu_Delay を参照）
　┣"View"			(【 ゲーム別 設定ファイルについて 】 にある Menu_Type を参照）
　┗"Stop Other Threads"	(【 ゲーム別 設定ファイルについて 】 にある Menu_Stop_Other を参照）





=============================================================================
メニュー操作用Keyの初期値について
=============================================================================
【 ゲーム別 設定ファイルについて 】 にある Menu_Key_XXXXX を参照）



=============================================================================
"Raw"フォーマットのセーブファイルについて
=============================================================================


データ（/PSP/SAVEDATA/ 内のファイルを）を直接編集しても
ゲーム側でそのまま読み込み可能、改造し放題
（ゲーム側で厳密なチェック等ががされていない場合）

MagicSaveのプラグインが使えないPSPだと読み込めません


MagicSaveが無効なPSPで読み込む為には
ファイルを以下の方法でPSP標準の状態へ戻す必要があります

■戻し方
1.ゲーム起動後にMagicSaveのメニューから、セーブフォーマットで"暗号化あり"を選んでセーブ
2.付属のSaveTypeCheckerで状態を確認


※ゲームによっては一部ファイルが元へ戻らない場合があります

=============================================================================
SaveTypeCheckerについて
=============================================================================

調べたいセーブファイルの"フォルダ"を、ドラッグ&ドロップして下さい
それぞれのファイルの状態（Raw/Nornal)を調べます

状態は Raw(非暗号化）、Normal（暗号化）、Invalid(無効）の3つです
Not Found 'File List'と出るものは判別不能です


※複数のフォルダを同時にチェック可能です
　状態を100%保証するものではありません、あくまでも目安程度にして下さい


=============================================================================
破損したセーブファイルの修復について
=============================================================================

セーブファイルをロードする際に
「ファイルが破損・・・」などでロード出来ない場合
以下の方法で修復出来るかもしれません

・FW/CFWのバージョンを変えた場合
・データ側に異常はなく、PARAM.SFOの状態が異常な場合

主に修復出来るのはこれらのファイルです

・セーブ中に変な操作をしてしまって破壊してしまった
・無理なチート等を使用して破壊してしまった

それらのデータは破損ファイル読み込み機能でロードは出来ますが
ゲーム側で異常な状態と判断されて修復出来ない可能性が高いです



■破損ファイル読み込み機能を使って修復
1."Read Invalid Data"を有効(Enable)にしたら
　"SFO File"、"Decrypt"のタイプを
　そのゲームに合った設定にします
　
　※セーブファイルを読み込む前に機能を有効にして設定も済ませて下さい (←重要）
　　SFO File/Decryptはデフォルト値でダメでも
　　設定を変えれば読み込める場合があります

2.正常にロード出来たら、そのままセーブする



■バックアップファイルから修復
1.セーブファイルを正常に読み込めるCFWで
　バックアップ機能を有効にしてファイルを書き出す
　(MagicSave/Save/???)

2.破損扱いになるCFWでゲーム起動後、適当にセーブを新規作成
　※その際、新規作成したセーブファイルのフォルダ名を調べておく

3.手順2で新規作成したデータをロードする際、
　手順1のバックアップファイルを読み込ませる
　(MagicSave/Save/???)
　
　※手順1で書き出したファイルのフォルダ名を手順2のと合わせる必要がある
　　"MagicSaveから読み込む"を有効にしないと読み込まれません

4.正常に読み込めたらセーブ


※複数セーブが作れるゲームで保存場所を維持したい場合は
　手順2でセーブを新規作成する際にスロット（フォルダ名）を
　バックアップファイル(手順1)のと合わせる必要があります



※破損ファイル読み込み機能でダメな場合でも
　バックアップファイルからなら修復出来るかもしれません
　
　これらの方法で必ず修復出来るとは限りません


※"Read Invalid Data"を使って修復した場合

　・ユーザー別にセーブ可能
　・一つのセーブフォルダ内にそららのファイルが別々に保存される
　
　この条件に当てはまるゲームはが破損ファイルのままになる事があります
　その時は"Read Invalid Data"で強制読み込みをした後
　再度セーブしなおせば直るはずです
　
　例：FLATOUTなど


=============================================================================
プラグイン機能について
=============================================================================

セーブファイルをセーブ・ロードした際に、
そのデータへ任意の処理をさせることが可能です

データの状態（暗号化されている、されていない）に関係なく処理可能ですが、
当然ながら暗号化されているデータへ処理する場合は
事前に非暗号化状態のファイルで構成などを調べてから
プラグインを作成する必要があります

ms0:/MagicSave/Plugins/ フォルダ内のプラグインをロード、アンロードした際は
ms0:/MagicSave/log.txt へログが出力されます

プラグイン作成は更に技術的な話になるので分かる方のみ試して下さい

MagicSave/Plugins/Sample フォルダにサンプルコードがあります


=============================================================================
Q&A
=============================================================================

Q:MagicSaveを有効にしても機能しない
A:他のプラグインと競合している可能性が高いです
　FWによってはNID変更が原因で正常動作していない場合があるので
　"不具合、要望について" で書かれている掲示板へ詳細を報告して下さい

Q:MagicSaveのプラグインを有効にすると起動しない、または突然フリーズする
A:ゲームモード(Normal/M33/NP9660/OE)や、形式(UMD/ISO/CSO)を変えれば解決するかもしれません
　他のプラグインと競合していることも考えられます

Q:ゲーム起動後、メニューからの設定が間に合わない
A:設定ファイルへ予め設定してからゲームを起動させれば
　その設定が起動直後から反映されます
　
　詳しくは【ゲーム別 設定ファイルについて】を参照

Q:"Raw"フォーマットのデータがロード出来ない
A:他のプラグインと競合している可能性が高いです
　MagicSaveのみ有効にしてみて下さい


Q:セーブファイルのフォーマット(Raw/Normal)を確認するには？
A:【SaveTypeCheckerについて】を参照して下さい

Q:"Raw"フォーマットで保存したセーブファイルを元の状態へ戻すには？
A:【"Raw"フォーマットのセーブファイルについて】を参照

Q:"Raw"フォーマットのセーブファイルは、他のPSPでも読み込めるか？
A:MagicSaveが有効なPSPでしか読み込めません
　元の状態へ戻せば今まで通り読み込み可能です
【"Raw"フォーマットのセーブファイルについて】を参照


Q:セーブファイルのフォーマット（保存形式）が変えられない
A:MagicSaveが有効になっているか、フォーマットが正しく指定されているかを確認して下さい

Q:"Read Invalid Data"を有効にしても、破損したセーブファイルを読み込めない
A:【破損したセーブファイルの修復について】を参照

Q:破損ファイルは読み込めたが、セーブしても破損ファイルのままになる
A:【破損したセーブファイルの修復について】を参照

Q:ゲーム別 設定ファイルがない場合の初期値を変えたい
A:【default.iniについて】を参照


=============================================================================
仕様、既知の問題
=============================================================================

※Ver 2.1より前のものは ゲーム起動後、数秒待たないとメニューは使用出来ません

※Ver が 1.2 より前のものはMagicSaveが起動してから
　数秒待たないとセーブファイルの監視がされません
　(起動直後にセーブファイルのロードがあるゲームへは対応出来ない）

・自作アプリ上では機能しない（技術的な問題ではなく、誤動作防止の為に）

・ファイルは必ず非暗号化状態になるとは限らない
（ゲーム製作側が独自の暗号化を施している場合がある）

・"Raw"フォーマット ファイルの先頭から0x10 Byte ( 0x00〜0x10 ) は余分なデータが追加されている
　ただし、その余分なデータは削除してはいけない
　
　※"Raw"フォーマットのファイルから先頭 0x10 Byte削ったものは
　　バックアップで保存されるファイルと同一になります

・GamekeyはFW 2.0以上のゲームのみDump可能
（FW 1.0〜1.5XのゲームはGamekeyをサポートしていない）

・CFWのVerが古いと動作しない
　M33、GENなら問題ないはず

・破損ファイルの読み込みはVer 2.0〜対応
　FW/CFWのバージョン違いによる破損ファイル修復はVer 3.0で対応


=============================================================================
不具合、要望について
=============================================================================
こちらの掲示板へ連絡お願いします

http://jbbs.livedoor.jp/computer/42872/


=============================================================================
動作確認済み動作確認済み
=============================================================================

CFW
・5.50 GEN-D2	(PSP-1000)
・5.50 GEN-D3	(PSP-1000)
・6.39 ME-8	(PSP-1000)

HEN
・6.20  TN-B	(PSP-1000)
・6.35  Pro	(PSP-1000 ※署名済みファイルを使用)

※制作者はPSP-1000しか所持してないので
　その他機種での動作確認は不可です
　各自、実際動くかどうか確認を



修復出来ない破損ファイルがあった場合
ファイルを添付して送ってもらえると対応出来るかもしれません
